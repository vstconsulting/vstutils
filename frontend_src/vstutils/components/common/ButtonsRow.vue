<template>
    <div class="buttons-row-wrapper d-print-none">
        <!-- Not grouped -->
        <OperationButton
            v-for="sublink in notGroupedSublinks"
            :key="sublink.name"
            v-bind="sublink"
            @click.native="$emit('open-sublink', sublink)"
        />
        <template v-for="action in notGroupedActions">
            <component :is="action.component" v-if="action.component" :key="action.name" :view="view" />
            <OperationButton
                v-else
                :key="action.name"
                v-bind="action"
                @click.native="$emit('execute-action', action)"
            />
        </template>

        <!-- Sublinks -->
        <template v-if="totalOperations > 2 && shouldGroupSublinks">
            <CompactOperations
                v-if="groupedSublinks.length"
                :title="$u.capitalize($t('sublinks'))"
                icon="fas fa-link"
                :view="view"
                :operations="groupedSublinks"
                @clicked="$emit('open-sublink', $event)"
            />
        </template>
        <template v-else>
            <OperationButton
                v-for="sublink in groupedSublinks"
                :key="sublink.name"
                v-bind="sublink"
                @click.native="$emit('open-sublink', sublink)"
            />
        </template>

        <!-- Actions -->
        <template v-if="totalOperations > 2 && shouldGroupActions">
            <CompactOperations
                v-if="groupedActions"
                :title="$u.capitalize($t('actions'))"
                icon="fas fa-ellipsis-v"
                :view="view"
                :operations="groupedActions"
                @clicked="$emit('execute-action', $event)"
            />
        </template>
        <template v-else>
            <template v-for="action in groupedActions">
                <component :is="action.component" v-if="action.component" :key="action.name" :view="view" />
                <OperationButton
                    v-else
                    :key="action.name"
                    v-bind="action"
                    @click.native="$emit('execute-action', action)"
                />
            </template>
        </template>
    </div>
</template>

<script>
    import OperationButton from './OperationButton.vue';
    import CompactOperations from './CompactOperations.vue';

    export default {
        name: 'ButtonsRow',
        components: { CompactOperations, OperationButton },
        props: {
            view: { type: Object, required: true },
            actions: { type: Array, default: () => [] },
            sublinks: { type: Array, default: () => [] },
        },
        computed: {
            totalOperations() {
                return this.actions.length + this.sublinks.length;
            },
            groupedActions() {
                return this.actions.filter((action) => !action.doNotGroup);
            },
            notGroupedActions() {
                return this.actions.filter((action) => action.doNotGroup);
            },
            shouldGroupActions() {
                return (
                    this.groupedActions.length > 1 ||
                    this.groupedActions.some((action) => !action.iconClasses)
                );
            },
            groupedSublinks() {
                return this.sublinks.filter((sublink) => !sublink.doNotGroup);
            },
            notGroupedSublinks() {
                return this.sublinks.filter((sublink) => sublink.doNotGroup);
            },
            shouldGroupSublinks() {
                return (
                    this.groupedSublinks.length > 1 ||
                    this.groupedSublinks.some((sublink) => !sublink.iconClasses)
                );
            },
        },
    };
</script>

<style scoped>
    .buttons-row-wrapper {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        flex-grow: 1;
        margin-bottom: 0;
        padding-bottom: 0;
        padding-right: 15px;
    }
    .buttons-row-wrapper::v-deep button {
        margin-top: 5px;
        margin-right: 5px;
        height: 35px;
    }
</style>
